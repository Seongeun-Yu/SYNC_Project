<mvc:View controllerName="cl3.syncyoung.sd.saleschart.saleschart.controller.SalesView"
    xmlns:mvc="sap.ui.core.mvc" displayBlock="true"
    xmlns="sap.m"
    xmlns:viz="sap.viz.ui5.controls" xmlns:layout="sap.ui.layout"
    xmlns:viz.data="sap.viz.ui5.data"
    xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
    xmlns:vl="sap.ui.layout">
    <Page id="page" title="{i18n>title}">
    <HBox alignItems="Center">
        <HBox justifyContent="SpaceBetween">
            <DateRangeSelection id="dateInput" class="DRS1" placeholder=" "
                                displayFormat="yyyy-MM-dd"
                                valueFormat="yyyy-MM-dd"
                                    value= "{
                                        'type': 'sap.ui.model.type.DateInterval',
                                        'formatOptions': { 'pattern': 'yyyy-MM-dd' },
                                        'parts': [
                                            {
                                                'type': 'sap.ui.model.type.Date',
                                                'path': '/start'
                                            },
                                            {
                                                'type': 'sap.ui.model.type.Date',
                                                'path': '/end'
                                            }
                                        ]
                                    }"/>
            <Label width="15px"/>
            <Button text="검색" type="Emphasized" press="onPress"/>
        </HBox>
    </HBox>
        
            
        <vl:Grid defaultSpan="XL6 L6 M12 S12" width="100%">

            <!-- 채널별 매출 -->
            <Panel class="marginPanel">
                <viz:VizFrame id="Channel" uiConfig="{applicationSet:'fiori'}" width="100%" vizType='donut'
                              vizProperties="{ title: {text : '채널별 매출', visible : true}}">
                    <viz:dataset>
                        <viz.data:FlattenedDataset data="{SalesPerChannelSet(p_start_date='19000101',p_end_date='99990131')/Set}">
                            <viz.data:dimensions>
                                <viz.data:DimensionDefinition name="유통채널" value="{channel}" />
                            </viz.data:dimensions>
                            <viz.data:measures>
                                <viz.data:MeasureDefinition name="매출" value="{netwr}" />
                            </viz.data:measures>
                        </viz.data:FlattenedDataset>
                    </viz:dataset>

                    <viz:feeds>
                        <viz.feeds:FeedItem uid="color" type="Dimension" values="유통채널" />
                        <viz.feeds:FeedItem uid="size" type="Measure" values="매출" />
                    </viz:feeds>
                    <viz:dependents>
                        <viz:Popover id="ChannelPopOver"></viz:Popover>
                    </viz:dependents>
                </viz:VizFrame>
            </Panel>

            <!-- BP별 매출 -->
            <Panel class="marginPanel">
                <viz:VizFrame id="BP" uiConfig="{applicationSet:'fiori'}" width="100%" vizType='bar'
                            vizProperties="{ title: {text : 'BP별 매출', visible : true}}"> <!-- 타이틀 세팅 -->

                    <viz:dataset>
                        <viz.data:FlattenedDataset id="BPChart" data="{bp>/SalesPerBPSet(p_start_date='19000101',p_end_date='99991231')/Set}"> <!-- Entity Set Name -->

                            <viz.data:dimensions>
                                <viz.data:DimensionDefinition name="BP" value="{bp>cname}" />
                            </viz.data:dimensions>

                            <viz.data:measures>
                                <viz.data:MeasureDefinition name="매출" value="{bp>netwr}" />  
                            </viz.data:measures>

                        </viz.data:FlattenedDataset>
                    </viz:dataset>

                    <viz:feeds>
                        <!--values에 DimensionDefinition의 name이 와야 함 -->
                        <viz.feeds:FeedItem id='categoryAxisFeed3' uid="categoryAxis" type="Dimension" values="BP" />
                        <viz.feeds:FeedItem id='valueAxisFeed3' uid="valueAxis" type="Measure" values="매출" /> 
                    </viz:feeds>

                    <viz:dependents>
                        <viz:Popover id="BPPopOver"></viz:Popover>
                    </viz:dependents>

                </viz:VizFrame>
            </Panel>

            

        </vl:Grid>

        <!-- 자재별 매출 -->
        <vl:Grid defaultSpan="XL12 L12 M12 S12" width="100%">

            <viz:VizFrame id="Material" uiConfig="{applicationSet:'fiori'}" width="100%" vizType='column'
                        vizProperties="{ title: {text : '자재별 매출', visible : true}}"> <!-- 타이틀 세팅 -->

                <viz:dataset>
                    <viz.data:FlattenedDataset id="MaterialChart" data="{material>/SalesPerMaterialSet(p_start_date='19000101',p_end_date='99991231')/Set}"> <!-- Entity Set Name -->

                        <viz.data:dimensions>
                            <viz.data:DimensionDefinition name="자재명" value="{material>maktx}" />
                        </viz.data:dimensions>

                        <viz.data:measures>
                            <viz.data:MeasureDefinition name="매출" value="{material>netwr}" />  
                        </viz.data:measures>

                    </viz.data:FlattenedDataset>
                </viz:dataset>

                <viz:feeds>
                    <!--values에 DimensionDefinition의 name이 와야 함 -->
                    <viz.feeds:FeedItem id='categoryAxisFeed2' uid="categoryAxis" type="Dimension" values="자재명" />
                    <viz.feeds:FeedItem id='valueAxisFeed2' uid="valueAxis" type="Measure" values="매출" /> 
                </viz:feeds>

                <viz:dependents>
                    <viz:Popover id="MaterialPopOver"></viz:Popover>
                </viz:dependents>

            </viz:VizFrame>

        </vl:Grid>

    </Page>
</mvc:View>
